<UserControl x:Class="QuestEditor.Graph.GraphControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:QuestEditor.Graph"
             xmlns:explorer="clr-namespace:QuestEditor.Explorer"
             xmlns:nodes="clr-namespace:QuestEditor.Nodes"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">


    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/QuestEditor;component/Themes/Generic.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <!-- Connections -->
        <ItemsControl ItemsSource="{Binding Connections}"
                  Panel.ZIndex="0"
                      Grid.Row="0"
                      Grid.Column="0">
            <ItemsControl.Resources>
                <DataTemplate DataType="{x:Type local:ConnectionVM}">
                    <StackPanel>
                        <local:ConnectionControl />
                    </StackPanel>
                </DataTemplate>
            </ItemsControl.Resources>
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <Canvas Background="Transparent" ClipToBounds="True"/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemContainerStyle>
                <Style TargetType="ContentPresenter">
                    <Setter Property="Canvas.Left" Value="0"/>
                    <Setter Property="Canvas.Top" Value="0"/>
                </Style>
            </ItemsControl.ItemContainerStyle>
        </ItemsControl>

        <!-- Nodes -->
        <ItemsControl ItemsSource="{Binding Nodes}" x:Name="NodesItemsControl"
                  Panel.ZIndex="1"
                      Grid.Row="0"
                      Grid.Column="0">
            <ItemsControl.Resources>
                <DataTemplate DataType="{x:Type nodes:StageNodeVM}">
                    <nodes:StageNodeControl Style="{StaticResource StageNodeControlStyle}"/>
                </DataTemplate>

                <DataTemplate DataType="{x:Type nodes:RewardNodeVM}">
                    <nodes:RewardNodeControl Style="{StaticResource RewardNodeControlStyle}"/>
                </DataTemplate>
            </ItemsControl.Resources>
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <Canvas
                            ClipToBounds="True"
                            Background="Transparent" 
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch"
                            MouseMove="Canvas_MouseMove"
                            MouseLeftButtonUp="Canvas_MouseLeftButtonUp" />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>

            <ItemsControl.ItemContainerStyle>
                <Style TargetType="ContentPresenter">
                    <Setter Property="Canvas.Left" Value="{Binding CanvasLeft}" />
                    <Setter Property="Canvas.Top" Value="{Binding CanvasTop}" />
                </Style>
            </ItemsControl.ItemContainerStyle>
        </ItemsControl>


        <StackPanel Orientation="Horizontal" MaxHeight="20" MaxWidth="360" Background="IndianRed" HorizontalAlignment="left" VerticalAlignment="Top" 
                  Panel.ZIndex="2"
                      Grid.Row="0"
                      Grid.Column="0">
            <TextBlock Text="Quest: " VerticalAlignment="Center" Margin="6,0,8,0" FontFamily="Times New Roman" FontWeight="Bold"/>
            <TextBox Text="{Binding CurrentQuest.Title, Mode=TwoWay}" VerticalContentAlignment="Center" FontFamily="Cascadia Mono SemiBold" Margin="0,1,0,2"/>
        </StackPanel>

    </Grid>
</UserControl>
