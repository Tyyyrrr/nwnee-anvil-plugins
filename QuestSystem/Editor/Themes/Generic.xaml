<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:QuestEditor"
    xmlns:shared="clr-namespace:QuestEditor.Shared"
    xmlns:explorer="clr-namespace:QuestEditor.Explorer"
    xmlns:graph="clr-namespace:QuestEditor.Graph"
    xmlns:nodes="clr-namespace:QuestEditor.Nodes">
    
    
    
    <!-- NODES -->
    <Style x:Key="NodeControlBaseStyle" TargetType="nodes:NodeControl">
        <Setter Property="Canvas.Left" Value="{Binding CanvasLeft, Mode=TwoWay}"/>
        <Setter Property="Canvas.Top" Value="{Binding CanvasTop, Mode=TwoWay}"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="nodes:NodeControl">
                    <Border 
                            Background="{TemplateBinding Background}" 
                            BorderBrush="{TemplateBinding BorderBrush}" 
                            BorderThickness="{TemplateBinding BorderThickness}" 
                            CornerRadius="{DynamicResource NodeCornerRadius}"
                            Opacity="{TemplateBinding Opacity}">
                        <StackPanel Background="DarkOrange">
                            <TextBlock Text="{Binding}" Foreground="Yellow"/>
                            <TextBlock Text="{Binding ID}" Background="Green"/>
                            <ContentPresenter 
                                Content="{Binding DataContext, RelativeSource={RelativeSource TemplatedParent}}"
                                ContentTemplate="{TemplateBinding ContentTemplate}"/>
                            <TextBox Text="{Binding NextIDString, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>


    <Style x:Key="NodeControlDefaultStyle" TargetType="nodes:NodeControl" BasedOn="{StaticResource NodeControlBaseStyle}">
        <Setter Property="Opacity" Value="0.8"/>
    </Style>

    <Style x:Key="StageNodeControlStyle" TargetType="nodes:StageNodeControl" BasedOn="{StaticResource NodeControlBaseStyle}">
        <Setter Property="ContentTemplate">
            <Setter.Value>
                <DataTemplate>
                    <StackPanel>
                        <TextBlock Text="{Binding JournalEntry}" Background="Red" />
                    </StackPanel>
                </DataTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <Style x:Key="RewardNodeControlStyle" TargetType="nodes:RewardNodeControl" BasedOn="{StaticResource NodeControlBaseStyle}">
        <Setter Property="ContentTemplate">
            <Setter.Value>
                <DataTemplate>
                    <StackPanel>
                        <TextBlock Text="RewardNodeControlStyle" Background="Green"/>
                    </StackPanel>
                </DataTemplate>
            </Setter.Value>
        </Setter>
    </Style>



    <!-- EXPLORER VIEW -->
    <Style x:Key="BaseSelectableItemStyle" TargetType="explorer:SelectableTreeViewItem">
        <Setter Property="ItemSelected" Value="{Binding IsSelected}"/>
        <Setter Property="ClickedCommand"
                Value="{Binding DataContext.SelectableItemClickedCommand,
                        RelativeSource={RelativeSource AncestorType=UserControl}}" />
        <Setter Property="Foreground" Value="{DynamicResource TreeViewItemForeground}"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="explorer:SelectableTreeViewItem">

                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Grid Grid.Row="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Border x:Name="PART_Border"
                                Grid.Column="1"
                                Background="Transparent"
                                Padding="4">
                                <ContentPresenter ContentSource="Header"
                                              IsHitTestVisible="False"/>
                            </Border>
                        </Grid>

                        <ItemsPresenter x:Name="PART_ItemsHost"
                                Grid.Row="1"
                                Margin="19,0,0,0"
                                Visibility="{Binding IsSelected, Converter={StaticResource BoolToVis}}"/>

                    </Grid>

                    <ControlTemplate.Triggers>
                        <Trigger Property="ItemSelected" Value="True">
                            <Setter TargetName="PART_Border" Property="BorderThickness" Value="2,0,2,0"/>
                            <Setter TargetName="PART_Border" Property="BorderBrush" Value="{DynamicResource TreeViewItemBorderBrush}"/>
                            <Setter TargetName="PART_Border" Property="Background" Value="{DynamicResource TreeViewItemSelectedBackgroundBrush}"/>
                        </Trigger>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="PART_Border" Property="BorderThickness" Value="1,0,1,0"/>
                            <Setter TargetName="PART_Border" Property="Background" Value="{DynamicResource TreeViewItemHoveredBrush}"/>
                            <Setter TargetName="PART_Border" Property="BorderBrush" Value="{DynamicResource TreeViewItemBorderBrush}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>

                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <Style TargetType="explorer:SelectableTreeViewItem"
       BasedOn="{StaticResource BaseSelectableItemStyle}" />
    
    <Style x:Key="QuestPackItemStyle" TargetType="explorer:SelectableTreeViewItem" BasedOn="{StaticResource BaseSelectableItemStyle}">
        <Setter Property="ContextMenu">
            <Setter.Value>
                <ContextMenu>
                    <MenuItem Header="Add Quest" Command="{Binding AddQuestCommand}"/>
                    <Separator/>
                    <MenuItem Header="Discard changes" Command="{Binding DiscardChangesCommand}"/>
                </ContextMenu>
            </Setter.Value>
        </Setter>
        <Setter Property="Foreground" Value="Red"/>
    </Style>

    <Style x:Key="QuestItemStyle" TargetType="explorer:SelectableTreeViewItem" BasedOn="{StaticResource BaseSelectableItemStyle}">
        <Setter Property="ContextMenu">
            <Setter.Value>
                <ContextMenu>
                    <MenuItem Header="Add Node" IsEnabled="{Binding IsSelected}" >
                        <MenuItem Header="Stage" Command="{Binding AddStageNodeCommand}"/>
                        <MenuItem Header="Reward" Command="{Binding AddRewardNodeCommand}"/>
                        <MenuItem Header="Randomizer" Command="{Binding AddRandomizerNodeCommand}"/>
                        <MenuItem Header="Cooldown" Command="{Binding AddCooldownNodeCommand}"/>
                        <MenuItem Header="Condition">
                            <MenuItem Header="... placeholder ..." Command="{Binding AddSomeCondition1Command}"/>
                            <MenuItem Header="... placeholder ..." Command="{Binding AddSomeCondition1Command}"/>
                            <MenuItem Header="... placeholder ..." Command="{Binding AddSomeCondition1Command}"/>
                        </MenuItem>
                    </MenuItem>
                    <!--<MenuItem Header="Rename Quest" Command="{Binding RenameCommand}" InputGestureText="Ctrl+R"/>-->
                    <MenuItem Header="Delete Quest" Command="{Binding DeleteQuestCommand}" CommandParameter="{Binding}"/>
                    <Separator/>
                    <MenuItem Header="Discard changes" Command="{Binding DiscardChangesCommand}" />
                </ContextMenu>
            </Setter.Value>
        </Setter>
        <Setter Property="Foreground" Value="Green"/>
    </Style>

    <Style x:Key="NodeItemStyle" TargetType="explorer:SelectableTreeViewItem" BasedOn="{StaticResource BaseSelectableItemStyle}">
        <Setter Property="ContextMenu">
            <Setter.Value>
                <ContextMenu>
                    <MenuItem Header="Delete Node" Command="{Binding DeleteNodeCommand}" CommandParameter="{Binding}"/>
                    <Separator/>
                    <MenuItem Header="Discard changes" Command="{Binding DiscardChangesCommand}"/>
                    <Separator/>
                </ContextMenu>
            </Setter.Value>
        </Setter>
        <Setter Property="Foreground" Value="Blue"/>
    </Style>

    <HierarchicalDataTemplate DataType="{x:Type explorer:QuestPackVM}" ItemsSource="{Binding Quests}">
        <TextBlock Text="{Binding DisplayText}" FontStyle="{Binding DisplayFontStyle}" FontWeight="{Binding DisplayFontWeight}" />
    </HierarchicalDataTemplate>

    <HierarchicalDataTemplate DataType="{x:Type explorer:QuestVM}" ItemsSource="{Binding Nodes}">
        <TextBlock Text="{Binding DisplayText}" FontStyle="{Binding DisplayFontStyle}" FontWeight="{Binding DisplayFontWeight}" />
    </HierarchicalDataTemplate>

    <HierarchicalDataTemplate DataType="{x:Type nodes:NodeVM}" >
        <TextBlock Text="{Binding NodeType}" />
    </HierarchicalDataTemplate>

        
    <!-- GRAPH -->

    <graph:BezierPointConverter x:Key="BPC"/>

    <Style TargetType="graph:ConnectionControl">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type graph:ConnectionControl}">
                    <Path Stroke="{Binding FromToColorGradientBrush}" 
                        StrokeThickness="3"
                        Stretch="None"
                        SnapsToDevicePixels="True">
                            <Path.Data>
                            <PathGeometry>
                                <PathGeometry.Figures>
                                    <PathFigureCollection>
                                        <PathFigure 
                                            StartPoint="{Binding FromToPoint,
                                                                 Converter={StaticResource BPC},
                                                                 ConverterParameter=1}">
                                            <BezierSegment 
                                                Point1="{Binding FromToPoint,
                                                                 Converter={StaticResource BPC},
                                                                 ConverterParameter=2}"
                                                Point2="{Binding FromToPoint,
                                                                 Converter={StaticResource BPC},
                                                                 ConverterParameter=3}"
                                                Point3="{Binding FromToPoint,
                                                                 Converter={StaticResource BPC},
                                                                 ConverterParameter=4}" />
                                        </PathFigure>
                                    </PathFigureCollection>
                                </PathGeometry.Figures>
                            </PathGeometry>
                        </Path.Data>
                    </Path>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>
